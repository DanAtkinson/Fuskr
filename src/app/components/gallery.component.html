<div class="gallery-container" [attr.data-display-mode]="imageDisplayMode">
	<div class="gallery-header">
		<div class="header-top">
			<h1>{{ translate('Gallery_Title') }}</h1>
			<div class="header-controls">
				<button class="btn btn-sm btn-outline-secondary theme-toggle" (click)="toggleDarkMode()" [title]="translate(darkMode ? 'Gallery_SwitchToLightMode' : 'Gallery_SwitchToDarkMode')">
					<i [class]="darkMode ? 'fas fa-sun' : 'fas fa-moon'"></i>
				</button>
			</div>
		</div>

		<div class="url-info">
			<label class="form-label">{{ translate('Gallery_OriginalUrl') }}</label>
			<div class="input-group mb-3">
				<input
					class="form-control"
					[placeholder]="translate('Gallery_UrlPlaceholder')"
					type="url"
					(keyup.enter)="generateGallery()"
					[(ngModel)]="originalUrl"
					/>
				<button class="btn btn-primary" (click)="generateGallery()">
					<i class="fas fa-images me-1"></i>{{ translate('Gallery_GenerateGallery') }}
				</button>
			</div>
		</div>

		@if (imageUrls.length > 0) {
			<div class="gallery-stats">
				<div class="stats-info">
					<span class="stat">{{ totalImages }} {{ translate('Gallery_Stats_Total') }}</span>
					<span class="stat">{{ loadedImages }} {{ translate('Gallery_Stats_Loaded') }}</span>
					@if (brokenImages > 0) {
						<span class="stat">{{ brokenImages }} {{ translate('Gallery_Stats_Broken') }}</span>
					}
				</div>
				<div class="stats-actions">
					<button
						class="btn btn-secondary btn-sm"
						(click)="downloadAll()"
						[disabled]="isDownloading">
						@if (isDownloading) {
							<div class="spinner-border spinner-border-sm me-2" role="status">
								<span class="visually-hidden">Loading...</span>
							</div>
						} @else {
							<i class="fas fa-download me-1"></i>
						}
						{{ isDownloading ? downloadStatus : translate('Gallery_DownloadAll') }}
					</button>
					@if (isDownloading && downloadProgress > 0) {
						<div class="progress mt-2" style="height: 4px;">
							<div
								class="progress-bar"
								role="progressbar"
								[style.width.%]="downloadProgress"
								[attr.aria-valuenow]="downloadProgress"
								aria-valuemin="0"
								aria-valuemax="100">
							</div>
						</div>
					}
				</div>
			</div>
		}

		<!-- Display Mode Controls -->
		@if (imageUrls.length > 0) {
			<div class="display-controls">
				<div class="control-group">
					<label>{{ translate('Gallery_DisplayMode') }}</label>
					<div class="button-group">
						<button
							(click)="setImageDisplayMode('fitOnPage')"
							[class]="imageDisplayMode === 'fitOnPage' ? 'btn btn-sm btn-primary' : 'btn btn-sm btn-outline-secondary'"
							[title]="translate('Images_ResizeImagesToFitOnPage')"
							>{{ translate('Gallery_FitPage') }}</button>
						<button
							(click)="setImageDisplayMode('fullWidth')"
							[class]="imageDisplayMode === 'fullWidth' ? 'btn btn-sm btn-primary' : 'btn btn-sm btn-outline-secondary'"
							[title]="translate('Images_ResizeImagesToFullWidth')"
							>{{ translate('Gallery_FullWidth') }}</button>
						<button
							(click)="setImageDisplayMode('fillPage')"
							[class]="imageDisplayMode === 'fillPage' ? 'btn btn-sm btn-primary' : 'btn btn-sm btn-outline-secondary'"
							[title]="translate('Images_ResizeImagesToFillPage')"
							>{{ translate('Gallery_FillPage') }}</button>
						<button
							(click)="setImageDisplayMode('thumbnails')"
							[class]="imageDisplayMode === 'thumbnails' ? 'btn btn-sm btn-primary' : 'btn btn-sm btn-outline-secondary'"
							[title]="translate('Images_ResizeImagesToThumbnails')"
							>{{ translate('Gallery_Thumbnails') }}</button>
					</div>
				</div>
				@if (brokenImages > 0 || loading) {
					<div class="control-group">
						<label>{{ translate('Gallery_Options') }}</label>
						<div class="button-group">
							<button
							(click)="toggleBrokenImagesVisibility()"
							[class]="showBrokenImages ? 'btn btn-sm btn-primary' : 'btn btn-sm btn-outline-secondary'"
							[title]="translate('Images_ToggleBrokenImages')"
							>{{ translate(showBrokenImages ? 'Gallery_HideBroken' : 'Gallery_ShowBroken') }}</button>
							@if (brokenImages > 0) {
								<button
								(click)="removeBrokenImages()"
								class="btn btn-sm btn-outline-danger"
								[title]="translate('Images_RemoveBrokenImages')"
								>{{ translate('Images_RemoveBrokenImages') }}</button>
							}
						</div>
					</div>
				}
			</div>
		}
	</div>

	@if (loading) {
		<div class="loading">
			<div class="spinner"></div>
			<p>{{ translate('Gallery_GeneratingGallery') }}</p>
		</div>
	}

	@if (errorMessage) {
		<div class="error">
			<p>{{ errorMessage }}</p>
		</div>
	}

	@if (imageUrls.length > 0 && !loading) {
		<div class="image-gallery"
			[class.images-are-full-width]="imageDisplayMode === 'fullWidth'"
			[class.images-are-full-page]="imageDisplayMode === 'fillPage'"
			[class.images-are-thumbnails]="imageDisplayMode === 'thumbnails'">
			@for (url of imageUrls; track url; let i = $index) {
				<div class="image-item wrap">
					<img
						class="fusk-image"
						loading="lazy"
						(click)="openImageViewer(url, i)"
						(error)="onImageError($event)"
						(load)="onImageLoad($event)"
						[alt]="getImageAltText(i)"
						[src]="url"
						[attr.data-original-url]="url"
						[attr.data-index]="i"
						>
					<div class="image-overlay">
						<span class="image-filename">{{ getFilename(url) }}</span>
						<div class="image-actions">
							<button class="btn btn-sm btn-outline-primary" (click)="downloadImage(url, $event)" [title]="translate('Images_DownloadImages')">
								<i class="fas fa-download"></i>
							</button>
							<button class="btn btn-sm btn-outline-secondary" (click)="copyUrl(url, $event)" [title]="translate('Gallery_CopyUrl')">
								<i class="fas fa-clipboard"></i>
							</button>
							<button class="btn btn-sm btn-outline-info" (click)="openImageViewer(url, i); $event.stopPropagation()" [title]="translate('Images_ShowImagesInViewer')">
								<i class="fas fa-search-plus"></i>
							</button>
						</div>
					</div>
				</div>
			}
		</div>
	}

	<!-- Image Viewer Modal -->
	@if (showImageViewer) {
		<div class="image-viewer-modal" (click)="closeImageViewer()">
			<div class="viewer-content" (click)="$event.stopPropagation()">
				<div class="viewer-header">
					<span class="viewer-title">{{ getFilename(currentViewerImage) }}</span>
					<span class="viewer-counter">{{ currentViewerIndex + 1 }} / {{ totalImages }}</span>
					<button class="btn btn-sm btn-outline-secondary close-btn" (click)="closeImageViewer()" [title]="translate('Gallery_Close')">
						<i class="fas fa-times"></i>
					</button>
				</div>
				<div class="viewer-body">
					<button
						class="btn btn-lg btn-outline-secondary nav-btn prev-btn"
						[title]="translate('Gallery_PreviousImage')"
						(click)="previousImage()"
						[disabled]="currentViewerIndex === 0"
						><i class="fas fa-chevron-left"></i></button>
					<img [src]="currentViewerImage" [alt]="getImageAltText(currentViewerIndex)">
					<button
						class="btn btn-lg btn-outline-secondary nav-btn next-btn"
						[title]="translate('Gallery_NextImage')"
						(click)="nextImage()"
						[disabled]="currentViewerIndex === imageUrls.length - 1"
						><i class="fas fa-chevron-right"></i></button>
				</div>
				<div class="viewer-footer">
					<button class="btn btn-secondary btn-sm" (click)="downloadImage(currentViewerImage, $event)">
						<i class="fas fa-download me-1"></i>{{ translate('Images_DownloadImages') }}
					</button>
					<button class="btn btn-secondary btn-sm" (click)="copyUrl(currentViewerImage, $event)">
						<i class="fas fa-clipboard me-1"></i>{{ translate('Gallery_CopyUrl') }}
					</button>
					<button class="btn btn-secondary btn-sm" (click)="openImage(currentViewerImage)">
						<i class="fas fa-external-link-alt me-1"></i>{{ translate('Gallery_OpenInTab') }}
					</button>
				</div>
			</div>
		</div>
	}

	@if (imageUrls.length === 0 && !loading && !errorMessage) {
		<div class="empty-state">
			<h2>{{ translate('Gallery_Welcome') }}</h2>
			<p>{{ translate('Gallery_WelcomeText') }}</p>
			<div class="examples">
				<h3>{{ translate('Gallery_ExampleUrls') }}</h3>
				<code>https://example.com/image01.jpg</code>
				<code>https://example.com/photo[01-10].png</code>
			</div>
		</div>
	}
</div>
